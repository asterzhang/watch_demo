<!DOCTYPE html>
<html>
<head>
    <title>moto 360 demo </title>
    <!--<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" rel="stylesheet">-->
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <link type="text/css" rel="stylesheet" href="assets/style/animate.css">
    <link type="text/css" rel="stylesheet" href="assets/style/main.css">
    <style>
      

    </style>
</head>

<body>
<div class="wrp">
    <div id="carousel">    
        <ul class="animate_box JS_animate_box_vertical">
            <li class="JS_pane pane pane1 hasSon" id="carousel_son">
            	<div class="inner sub_animate_box JS_animate_box_vertical_sub" id="cards">
                    <dl class="JS_card msg_card card1  card_animate card_animate1">
                        <dt class="db">
                            <div class="msg_box">
                                <div class="header">
                                    <img src="assets/img/logo.png" class="logo" alt="logo"/>
                                    <span class="animate_fadeInUp msg_mount">5</span>
                                </div>
                                <div class="sender">
                                    <div class="sender_pro">
                                        <img src="assets/img/avator.png" class="avator" alt="avator">
                                        <p class="name">Aster</p>
                                    </div>
                                    <div class="msg_con">
                                        <p>我们一起去看变形金刚吧？？</p>
                                        <p>你说好不好呀</p>
                                    </div>
                                </div>
                                <div class="next_contract">
                                    <img src="assets/img/next_avator.png" class="avator" alt="avator">
                                </div>
                            </div>
                        </dt>
                        <dd style="display:none;">
                            <ul class="detail_card_box">
                                <li class="cardOpr_page">
                                    <div class="hd_opr"><a href="#" class="give_ring">打电话</a></div>
                                    <div class="default_msgList">
                                         <p><a href="#">我马上回来</a></p>
                                         <p><a href="#">我一会回复你</a></p>
                                         <p><a href="#">现在很忙</a></p>
                                         <p><a href="#">没问题</a></p>
                                         <p><a href="#">天气真不错</a></p>
                                         <p><a href="#">GOOD </a></p>
                                         <p><a href="#">NO WAY </a></p>
                                         <p><a href="#">OK </a></p>
                                    </div>
                                    <div class="next_contract">
                                        <img src="assets/img/next_avator.png" class="avator" alt="avator">
                                    </div>
                                </li>
                                <li class="cardSendMsg_page none">
                                    <div class="wrp_sending">
                                        <div class="wrp_loading hd">
                                            <div  class="dot_wave_1 dot_wave"></div>
                                            <div  class="dot_wave_2 dot_wave"></div>
                                            <div  class="dot_wave_3 dot_wave"></div>
                                        </div>
                                        <div class="sending_msg_con">
                                            <p>显示正在发送的消息..</p>
                                        </div>
                                        <div class="ft_opr">
                                            <a href="#" class="btn_cancel_send"></a>
                                        </div>
                                    </div>
                                    <div class="success_info none"></div>
                                </li>
                                <li class="CardCall_page none">
                                    <div class="hd_opr"><a href="#" class="hang_on">挂断电话</a></div>
                                    <div class="current_person">
                                        <img src="assets/img/avator_big_size.png" width="182">
                                    </div>
                                    <div class="talked_time">02:34</div>
                                </li>
                            </ul>
                        </dd>
                    </dl>
                    <dl class="JS_card msg_card card2  card_animate card_animate2">
                        <dt class="db">
                            <div class="msg_box">
                                <div class="header">
                                    <img src="assets/img/logo.png" class="logo" alt="logo"/>
                                    <span class="animate_fadeInUp msg_mount">4</span>
                                </div>
                                <div class="sender">
                                    <div class="sender_pro">
                                        <img src="assets/img/avator.png" class="avator" alt="avator">
                                        <p class="name">damon</p>
                                    </div>
                                    <div class="msg_con">
                                        <p>NO Problem</p>
                                        <p>It's your time</p>
                                    </div>
                                </div>
                                <div class="next_contract">
                                    <img src="assets/img/next_avator.png" class="avator" alt="avator">
                                </div>
                            </div>
                        </dt>
                        <dd style="display:none;">
                            <ul class="detail_card_box">
                                <li class="cardOpr_page">
                                    <div class="hd_opr"><a href="#" class="give_ring">打电话</a></div>
                                    <div class="default_msgList">
                                         <p><a href="#">我马上回来</a></p>
                                         <p><a href="#">我一会回复你</a></p>
                                         <p><a href="#">现在很忙</a></p>
                                         <p><a href="#">没问题</a></p>
                                         <p><a href="#">天气真不错</a></p>
                                         <p><a href="#">GOOD </a></p>
                                         <p><a href="#">NO WAY </a></p>
                                         <p><a href="#">OK </a></p>
                                    </div>
                                    <div class="next_contract">
                                        <img src="assets/img/next_avator.png" class="avator" alt="avator">
                                    </div>
                                </li>
                                <li class="cardSendMsg_page none">
                                    <div class="wrp_sending">
                                        <div class="wrp_loading hd">
                                            <div  class="dot_wave_1 dot_wave"></div>
                                            <div  class="dot_wave_2 dot_wave"></div>
                                            <div  class="dot_wave_3 dot_wave"></div>
                                        </div>
                                        <div class="sending_msg_con">
                                            <p>显示正在发送的消息..</p>
                                        </div>
                                        <div class="ft_opr">
                                            <a href="#" class="btn_cancel_send"></a>
                                        </div>
                                    </div>
                                    <div class="success_info none"></div>
                                </li>
                                <li class="CardCall_page none">
                                    <div class="hd_opr"><a href="#" class="hang_on">挂断电话</a></div>
                                    <div class="current_person">
                                        <img src="assets/img/avator_big_size.png" width="182">
                                    </div>
                                    <div class="talked_time">02:34</div>
                                </li>
                            </ul>
                        </dd>
                    </dl>
                   
                   <dl class="JS_card msg_card card3  card_animate card_animate3">
                       <dt class="db">
                           <div class="msg_box">
                               <div class="header">
                                   <img src="assets/img/logo.png" class="logo" alt="logo"/>
                                   <span class="animate_fadeInUp msg_mount">3</span>
                               </div>
                               <div class="sender">
                                   <div class="sender_pro">
                                       <img src="assets/img/avator.png" class="avator" alt="avator">
                                       <p class="name">Aster</p>
                                   </div>
                                   <div class="msg_con">
                                       <p>走吧，说走就走</p>
                                       <p>你说好不好呀</p>
                                   </div>
                               </div>
                               <div class="next_contract">
                                   <img src="assets/img/next_avator.png" class="avator" alt="avator">
                               </div>
                           </div>
                       </dt>
                       <dd style="display:none;">
                           <ul class="detail_card_box">
                               <li class="cardOpr_page">
                                   <div class="hd_opr"><a href="#" class="give_ring">打电话</a></div>
                                   <div class="default_msgList">
                                        <p><a href="#">我马上回来</a></p>
                                        <p><a href="#">我一会回复你</a></p>
                                        <p><a href="#">现在很忙</a></p>
                                        <p><a href="#">没问题</a></p>
                                        <p><a href="#">天气真不错</a></p>
                                        <p><a href="#">GOOD </a></p>
                                        <p><a href="#">NO WAY </a></p>
                                        <p><a href="#">OK </a></p>
                                   </div>
                                   <div class="next_contract">
                                       <img src="assets/img/next_avator.png" class="avator" alt="avator">
                                   </div>
                               </li>
                               <li class="cardSendMsg_page none">
                                   <div class="wrp_sending">
                                       <div class="wrp_loading hd">
                                           <div  class="dot_wave_1 dot_wave"></div>
                                           <div  class="dot_wave_2 dot_wave"></div>
                                           <div  class="dot_wave_3 dot_wave"></div>
                                       </div>
                                       <div class="sending_msg_con">
                                           <p>显示正在发送的消息..</p>
                                       </div>
                                       <div class="ft_opr">
                                           <a href="#" class="btn_cancel_send"></a>
                                       </div>
                                   </div>
                                   <div class="success_info none"></div>
                               </li>
                               <li class="CardCall_page none">
                                   <div class="hd_opr"><a href="#" class="hang_on">挂断电话</a></div>
                                   <div class="current_person">
                                       <img src="assets/img/avator_big_size.png" width="182">
                                   </div>
                                   <div class="talked_time">02:34</div>
                               </li>
                           </ul>
                       </dd>
                   </dl>

                   <dl class="JS_card msg_card card4  card_animate card_animate4">
                       <dt class="db">
                           <div class="msg_box">
                               <div class="header">
                                   <img src="assets/img/logo.png" class="logo" alt="logo"/>
                                   <span class="animate_fadeInUp msg_mount">2</span>
                               </div>
                               <div class="sender">
                                   <div class="sender_pro">
                                       <img src="assets/img/avator.png" class="avator" alt="avator">
                                       <p class="name">Damon</p>
                                   </div>
                                   <div class="msg_con">
                                       <p>我们一起去看变形金刚吧？？</p>
                                       <p>你说好不好呀</p>
                                   </div>
                               </div>
                               <div class="next_contract">
                                   <img src="assets/img/next_avator.png" class="avator" alt="avator">
                               </div>
                           </div>
                       </dt>
                       <dd style="display:none;">
                           <ul class="detail_card_box">
                               <li class="cardOpr_page">
                                   <div class="hd_opr"><a href="#" class="give_ring">打电话</a></div>
                                   <div class="default_msgList">
                                        <p><a href="#">我马上回来</a></p>
                                        <p><a href="#">我一会回复你</a></p>
                                        <p><a href="#">现在很忙</a></p>
                                        <p><a href="#">没问题</a></p>
                                        <p><a href="#">天气真不错</a></p>
                                        <p><a href="#">GOOD </a></p>
                                        <p><a href="#">NO WAY </a></p>
                                        <p><a href="#">OK </a></p>
                                   </div>
                                   <div class="next_contract">
                                       <img src="assets/img/next_avator.png" class="avator" alt="avator">
                                   </div>
                               </li>
                               <li class="cardSendMsg_page none">
                                   <div class="wrp_sending">
                                       <div class="wrp_loading hd">
                                           <div  class="dot_wave_1 dot_wave"></div>
                                           <div  class="dot_wave_2 dot_wave"></div>
                                           <div  class="dot_wave_3 dot_wave"></div>
                                       </div>
                                       <div class="sending_msg_con">
                                           <p>显示正在发送的消息..</p>
                                       </div>
                                       <div class="ft_opr">
                                           <a href="#" class="btn_cancel_send"></a>
                                       </div>
                                   </div>
                                   <div class="success_info none"></div>
                               </li>
                               <li class="CardCall_page none">
                                   <div class="hd_opr"><a href="#" class="hang_on">挂断电话</a></div>
                                   <div class="current_person">
                                       <img src="assets/img/avator_big_size.png" width="182">
                                   </div>
                                   <div class="talked_time">02:34</div>
                               </li>
                           </ul>
                       </dd>
                   </dl>
                     
                    <dl class="JS_card msg_card card5  card_animate card_animate5">
                        <dt class="db">
                            <div class="msg_box">
                                <div class="header">
                                    <img src="assets/img/logo.png" class="logo" alt="logo"/>
                                    <span class="animate_fadeInUp msg_mount">1</span>
                                </div>
                                <div class="sender">
                                    <div class="sender_pro">
                                        <img src="assets/img/avator.png" class="avator" alt="avator">
                                        <p class="name">Bear</p>
                                    </div>
                                    <div class="msg_con">
                                        <p>我们一起去看变形金刚吧？？</p>
                                        <p>你说好不好呀</p>
                                    </div>
                                </div>
                                <div class="next_contract">
                                    <img src="assets/img/next_avator.png" class="avator" alt="avator">
                                </div>
                            </div>
                        </dt>
                        <dd style="display:none;">
                            <ul class="detail_card_box">
                                <li class="cardOpr_page">
                                    <div class="hd_opr"><a href="#" class="give_ring">打电话</a></div>
                                    <div class="default_msgList">
                                         <p><a href="#">我马上回来</a></p>
                                         <p><a href="#">我一会回复你</a></p>
                                         <p><a href="#">现在很忙</a></p>
                                         <p><a href="#">没问题</a></p>
                                         <p><a href="#">天气真不错</a></p>
                                         <p><a href="#">GOOD </a></p>
                                         <p><a href="#">NO WAY </a></p>
                                         <p><a href="#">OK </a></p>
                                    </div>
                                    <div class="next_contract">
                                        <img src="assets/img/next_avator.png" class="avator" alt="avator">
                                    </div>
                                </li>
                                <li class="cardSendMsg_page none">
                                    <div class="wrp_sending">
                                        <div class="wrp_loading hd">
                                            <div  class="dot_wave_1 dot_wave"></div>
                                            <div  class="dot_wave_2 dot_wave"></div>
                                            <div  class="dot_wave_3 dot_wave"></div>
                                        </div>
                                        <div class="sending_msg_con">
                                            <p>显示正在发送的消息..</p>
                                        </div>
                                        <div class="ft_opr">
                                            <a href="#" class="btn_cancel_send"></a>
                                        </div>
                                    </div>
                                    <div class="success_info none"></div>
                                </li>
                                <li class="CardCall_page none">
                                    <div class="hd_opr"><a href="#" class="hang_on">挂断电话</a></div>
                                    <div class="current_person">
                                        <img src="assets/img/avator_big_size.png" width="182">
                                    </div>
                                    <div class="talked_time">02:34</div>
                                </li>
                            </ul>
                        </dd>
                    </dl>
                </div>            	
            </li>
            <li class="JS_pane pane pane2">
                <div class="inner"><h1>Second.  home page..</h1></div>               
            </li>
            
            <li class="JS_pane pane pane3">
                <div class="inner"><h1>Third.  home page..</h1></div>                
            </li>
            
            <li class="JS_pane pane pane4">
                <div class="inner"> <h1>Fourth  home page...</h1></div>                
            </li>
            
            <li class="JS_pane pane pane5">
               <div class="inner"><h1>Five  home page...</h1></div>                
            </li>            
        </ul>
        <div class="nav none">
            <ul class="nav_list JS_navList">
                <li class="current">1</li>
                <li>2</li>
                <li>3</li>
                <li>4</li>
                <li>5</li>
            </ul>
        </div>
        <div class="nav nav2 none">
            <ul class="nav_list JS_navList2">
                <li class="current">1</li>
                <li>2</li>
                <li>3</li>
                <li>4</li>
                <li>5</li>
            </ul>
        </div> 
    </div>

    <div class="mask_top"></div>
    <div class="mask_mid_left"></div>
    <div class="mask_mid_right"></div>
    <div class="mask_ft"></div>
</div>

    <!-- jQuery is just for the demo! Hammer.js works without jQuery :-) -->
    <script type="text/javascript" src="/htdocs/zh_CN/htmledition/common/js/lib/module/jquery.js"></script>
    <script src="assets/js/modernizr.js"></script>
    <script src="assets/js/hammer.js"></script>
    <script src="assets/js/carousel.js"></script>
    <script>
    document.ontouchstart = function(e){e.preventDefault();}
   
    //监听JS_animate_box_vertical_sub 下面是否还有dl("JS_card") 
   // function HasCard(){
           
   // }
   // var autoJudgeChild=setInterval(HasCard, 100);
   
    function Carousel_Wrapper(element,className,className_son)
    {
        var self = this;
        element = $(element);

        var container = $(className,element);
        var panes = $(className_son,element);
        var pane_height=0;
        var pane_count = panes.length;
        var current_pane = 0;
        
        //默认一进来可以上下滑动，不可以左右，只有进入了当个app后才可以左右滑动

        


        /**
         * initial
         */
        this.init = function() {
            setPaneDimensions();
            $(window).on("load resize orientationchange", function() {
                setPaneDimensions();
            })
        };


        /**
         * set the pane dimensions and scale the container
         */
        function setPaneDimensions() {
            pane_height = element.height();
            panes.each(function() {
                $(this).width(pane_height);
            });
            container.height(pane_height*pane_count);
        };


        /**
         * show pane by index
         */
        this.showPane = function(index, animate) {
            // between the bounds
            index = Math.max(0, Math.min(index, pane_count-1));
            current_pane = index;
            console.log("pane_count:"+pane_count);
            console.log("current_pane:"+current_pane);
            var offset = -((100/pane_count)*current_pane);
             
            setContainerOffset(offset, animate);

        };


        function setContainerOffset(percent, animate) {
            
            container.removeClass("animate");

            if(animate) {
                container.addClass("animate");
                showNav(current_pane);
            }

            if(Modernizr.csstransforms3d) {
                container.css("transform", "translate3d(0,"+ percent +"%,0) scale3d(1,1,1)");
                
            }
            else if(Modernizr.csstransforms) {
                container.css("transform", "translate(0,"+ percent +"%)");              
            }
            else {
                var px = ((pane_height*pane_count) / 100) * percent;
                container.css("top", px+"px");
                
            }
        }
        
      
        function showNav(current_pane){
            for(var i=0;i<pane_count;i++){
                if(i==current_pane){
                    $(".JS_navList2 li").eq(i).addClass("current");
                }
                else
                    $(".JS_navList2 li").eq(i).removeClass("current");
            }
        }
        
        
        this.next = function() {
            //alert(1);
            return this.showPane(current_pane+1, true);
         };
        this.prev = function() { 
            return this.showPane(current_pane-1, true);
        };


        function handleHammer(ev) {
            // disable browser scrolling
            ev.gesture.preventDefault();

            switch(ev.type) {
                case 'dragdown':
                case 'dragup':
                    // stick to the finger
                    var pane_offset = -(100/pane_count)*current_pane;
                    var drag_offset = ((100/pane_height)*ev.gesture.deltaX) / pane_count;

                    // slow down at the first and last pane
                    if((current_pane == 0 && ev.gesture.direction == "up") ||
                        (current_pane == pane_count-1 && ev.gesture.direction == "down")) {
                        drag_offset *= .4;
                    }

                    setContainerOffset(drag_offset + pane_offset);
                    break;

                case 'swipeup':
                    self.next();
                    ev.gesture.stopDetect();
                    break;

                case 'swipedown':
                    self.prev();
                    ev.gesture.stopDetect();
                    break;

                case 'release':
                    // more then 50% moved, navigate
                    if(Math.abs(ev.gesture.deltaY) > pane_height/2) {
                        if(ev.gesture.direction == 'down') {
                            self.prev();
                        } else {
                            self.next();
                        }
                    }
                    else {
                        self.showPane(current_pane, true);
                    }
                    break;
            }
        }
        new Hammer(element[0], { dragLockToAxis: true }).on("release dragup dragdown swipeup swipedown", handleHammer);
    }
     
    var carousel = new Carousel("#carousel_son",".JS_animate_box_vertical_sub",".JS_card");
    carousel.active = true;
    carousel.init();
    $(".default_msgList a").click(function(){
        $(this).parents(".cardOpr_page").fadeOut().siblings(".cardSendMsg_page").fadeIn();
           var sending=setTimeout(function(){
                  console.log(1);
                  // $(this).parents(".cardOpr_page").siblings(".cardSendMsg_page").find(".wrp_sending").addClass("none");                   
                  // $(this).parents(".cardOpr_page").siblings(".cardSendMsg_page").find(".success_info").removeClass("none").fadeIn();
                  $(".wrp_sending").addClass("none"); 
                  $(".success_info").removeClass("none").fadeIn();
                    //有当前children读取的时候有问题
                   setTimeout(function (argument) {
                      carousel.removeCurrentPane();
                      /*$(".wrp_sending").removeClass("none"); 
                      $(".success_info").addClass("none");*/
                   },1000);
           },1500 );
          $(".btn_cancel_send").each(function (index,item) {
            Hammer(item).on("tap",function(){
            clearTimeout(sending);
              $(this).parents(".cardSendMsg_page").fadeOut().siblings(".cardOpr_page").fadeIn();
            });
          });
    });

$(".give_ring").each(function (index,item) {
    Hammer(item).on("tap",function(){
        $(this).parents(".cardOpr_page").fadeOut().siblings(".CardCall_page").fadeIn();      
    });
});
    
$(".hang_on").each(function (index,item) {
    Hammer(item).on("tap",function(){
            $(this).addClass("hang_on_gray");
            $(this).parents(".hd_opr").siblings(".current_person").addClass("blur");
            $(this).parents(".hd_opr").siblings(".talked_time").html("结束通话...");
            setTimeout(function (argument) {
              carousel.removeCurrentPane();
            },1000);
    });  
});
   
    $(".default_msgList").on("touchstart", function(e){e.stopPropagation();})
    </script>



</body>
</html>
